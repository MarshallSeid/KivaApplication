$( document ).ready(function() {
var map = {"themes": {"Job Creation": {"total_funds": 100.0, "num_loans": 1.0, "avg_funded": 100.0}, "Start-Up": {"total_funds": 1475.0, "num_loans": 2.0, "avg_funded": 737.5}, "Mobile Technology": {"total_funds": 0.0, "num_loans": 0.0, "avg_funded": 0.0}, "Disaster recovery": {"total_funds": 0.0, "num_loans": 0.0, "avg_funded": 0.0}, "Health": {"total_funds": 0.0, "num_loans": 0.0, "avg_funded": 0.0}, "Islamic Finance": {"total_funds": 1300.0, "num_loans": 4.0, "avg_funded": 325.0}, "Kiva City Detroit": {"total_funds": 0.0, "num_loans": 0.0, "avg_funded": 0.0}, "SME": {"total_funds": 0.0, "num_loans": 0.0, "avg_funded": 0.0}, "Higher Education": {"total_funds": 49625.0, "num_loans": 48.0, "avg_funded": 1033.8541666666667}, "Vulnerable Groups": {"total_funds": 66000.0, "num_loans": 35.0, "avg_funded": 1885.7142857142858}, "IPA Study": {"total_funds": 1575.0, "num_loans": 3.0, "avg_funded": 525.0}, "Growing Businesses": {"total_funds": 0.0, "num_loans": 0.0, "avg_funded": 0.0}, "Youth": {"total_funds": 3250.0, "num_loans": 4.0, "avg_funded": 812.5}, "Green": {"total_funds": 9700.0, "num_loans": 19.0, "avg_funded": 510.5263157894737}, "Fair Trade": {"total_funds": 17100.0, "num_loans": 8.0, "avg_funded": 2137.5}, "Arab Youth": {"total_funds": 1100.0, "num_loans": 1.0, "avg_funded": 1100.0}, "Rural Exclusion": {"total_funds": 29050.0, "num_loans": 70.0, "avg_funded": 415.0}, "Kiva City LA": {"total_funds": 0.0, "num_loans": 0.0, "avg_funded": 0.0}, "Innovative Loans": {"total_funds": 15825.0, "num_loans": 8.0, "avg_funded": 1978.125}, "Flexible Credit Study": {"total_funds": 1575.0, "num_loans": 3.0, "avg_funded": 525.0}, "Conflict Zones": {"total_funds": 21425.0, "num_loans": 11.0, "avg_funded": 1947.7272727272727}, "Water and Sanitation": {"total_funds": 4650.0, "num_loans": 14.0, "avg_funded": 332.14285714285717}, "Underfunded Areas": {"total_funds": 30200.0, "num_loans": 56.0, "avg_funded": 539.2857142857143}, "Refugees/Displaced": {"total_funds": 1000.0, "num_loans": 1.0, "avg_funded": 1000.0}}, "activities": {"Arts": {"total_funds": 525, "num_loans": 1, "avg_funded": 525}, "Sewing": {"total_funds": 5525, "num_loans": 7, "avg_funded": 789}, "Used Shoes": {"total_funds": 150, "num_loans": 1, "avg_funded": 150}, "Food Market": {"total_funds": 2425, "num_loans": 2, "avg_funded": 1212}, "Education provider": {"total_funds": 8575, "num_loans": 10, "avg_funded": 857}, "Tailoring": {"total_funds": 2725, "num_loans": 9, "avg_funded": 302}, "Cosmetics Sales": {"total_funds": 8800, "num_loans": 4, "avg_funded": 2200}, "Electronics Repair": {"total_funds": 325, "num_loans": 1, "avg_funded": 325}, "Pharmacy": {"total_funds": 475, "num_loans": 2, "avg_funded": 237}, "Primary/secondary school costs": {"total_funds": 18525, "num_loans": 26, "avg_funded": 712}, "Farm Supplies": {"total_funds": 375, "num_loans": 2, "avg_funded": 187}, "Dairy": {"total_funds": 3350, "num_loans": 9, "avg_funded": 372}, "Beauty Salon": {"total_funds": 4625, "num_loans": 2, "avg_funded": 2312}, "Embroidery": {"total_funds": 700, "num_loans": 2, "avg_funded": 350}, "Natural Medicines": {"total_funds": 3050, "num_loans": 1, "avg_funded": 3050}, "Home Appliances": {"total_funds": 1275, "num_loans": 3, "avg_funded": 425}, "Weaving": {"total_funds": 275, "num_loans": 2, "avg_funded": 137}, "Consumer Goods": {"total_funds": 600, "num_loans": 1, "avg_funded": 600}, "Farming": {"total_funds": 24800, "num_loans": 52, "avg_funded": 476}, "Sporting Good Sales": {"total_funds": 300, "num_loans": 1, "avg_funded": 300}, "Food Stall": {"total_funds": 2750, "num_loans": 6, "avg_funded": 458}, "Manufacturing": {"total_funds": 950, "num_loans": 2, "avg_funded": 475}, "Perfumes": {"total_funds": 3075, "num_loans": 1, "avg_funded": 3075}, "Transportation": {"total_funds": 325, "num_loans": 2, "avg_funded": 162}, "Food": {"total_funds": 15450, "num_loans": 10, "avg_funded": 1545}, "Photography": {"total_funds": 250, "num_loans": 1, "avg_funded": 250}, "Higher education costs": {"total_funds": 51500, "num_loans": 53, "avg_funded": 971}, "Pub": {"total_funds": 250, "num_loans": 1, "avg_funded": 250}, "Fruits & Vegetables": {"total_funds": 15700, "num_loans": 16, "avg_funded": 981}, "Pigs": {"total_funds": 6575, "num_loans": 18, "avg_funded": 365}, "Rickshaw": {"total_funds": 200, "num_loans": 1, "avg_funded": 200}, "Furniture Making": {"total_funds": 225, "num_loans": 1, "avg_funded": 225}, "Internet Cafe": {"total_funds": 1200, "num_loans": 1, "avg_funded": 1200}, "Services": {"total_funds": 1500, "num_loans": 2, "avg_funded": 750}, "Flowers": {"total_funds": 250, "num_loans": 2, "avg_funded": 125}, "Home Products Sales": {"total_funds": 6675, "num_loans": 3, "avg_funded": 2225}, "Clothing": {"total_funds": 18125, "num_loans": 4, "avg_funded": 4531}, "General Store": {"total_funds": 13525, "num_loans": 32, "avg_funded": 422}, "Cloth & Dressmaking Supplies": {"total_funds": 400, "num_loans": 1, "avg_funded": 400}, "Poultry": {"total_funds": 4450, "num_loans": 9, "avg_funded": 494}, "Bookstore": {"total_funds": 1875, "num_loans": 2, "avg_funded": 937}, "Clothing Sales": {"total_funds": 13200, "num_loans": 11, "avg_funded": 1200}, "Used Clothing": {"total_funds": 4450, "num_loans": 4, "avg_funded": 1112}, "Restaurant": {"total_funds": 10875, "num_loans": 2, "avg_funded": 5437}, "Charcoal Sales": {"total_funds": 950, "num_loans": 3, "avg_funded": 316}, "Personal Housing Expenses": {"total_funds": 8725, "num_loans": 29, "avg_funded": 300}, "Personal Medical Expenses": {"total_funds": 575, "num_loans": 1, "avg_funded": 575}, "Butcher Shop": {"total_funds": 1225, "num_loans": 3, "avg_funded": 408}, "Bakery": {"total_funds": 7925, "num_loans": 5, "avg_funded": 1585}, "Food Production/Sales": {"total_funds": 14025, "num_loans": 14, "avg_funded": 1001}, "Crafts": {"total_funds": 14500, "num_loans": 6, "avg_funded": 2416}, "Secretarial Services": {"total_funds": 600, "num_loans": 1, "avg_funded": 600}, "Electrician": {"total_funds": 1300, "num_loans": 1, "avg_funded": 1300}, "Personal Purchases": {"total_funds": 3275, "num_loans": 8, "avg_funded": 409}, "Retail": {"total_funds": 22600, "num_loans": 20, "avg_funded": 1130}, "Taxi": {"total_funds": 2625, "num_loans": 1, "avg_funded": 2625}, "Cafe": {"total_funds": 1850, "num_loans": 2, "avg_funded": 925}, "Cereals": {"total_funds": 1050, "num_loans": 5, "avg_funded": 210}, "Livestock": {"total_funds": 5100, "num_loans": 9, "avg_funded": 566}, "Home Energy": {"total_funds": 3275, "num_loans": 6, "avg_funded": 545}, "Fish Selling": {"total_funds": 2425, "num_loans": 7, "avg_funded": 346}, "Hardware": {"total_funds": 600, "num_loans": 1, "avg_funded": 600}, "Motorcycle Transport": {"total_funds": 725, "num_loans": 4, "avg_funded": 181}, "Personal Products Sales": {"total_funds": 400, "num_loans": 2, "avg_funded": 200}, "Electrical Goods": {"total_funds": 1025, "num_loans": 1, "avg_funded": 1025}, "Fishing": {"total_funds": 575, "num_loans": 3, "avg_funded": 191}, "Cattle": {"total_funds": 5300, "num_loans": 7, "avg_funded": 757}, "Animal Sales": {"total_funds": 6300, "num_loans": 7, "avg_funded": 900}, "Shoe Sales": {"total_funds": 1150, "num_loans": 1, "avg_funded": 1150}, "Agriculture": {"total_funds": 6250, "num_loans": 15, "avg_funded": 416}, "Grocery Store": {"total_funds": 16600, "num_loans": 15, "avg_funded": 1106}}, "sectors": {"Arts": {"total_funds": 16000.0, "num_loans": 11.0, "avg_funded": 1454.5454545454545}, "Entertainment": {"total_funds": 0.0, "num_loans": 0.0, "avg_funded": 0.0}, "Wholesale": {"total_funds": 0.0, "num_loans": 0.0, "avg_funded": 0.0}, "Housing": {"total_funds": 8725.0, "num_loans": 29.0, "avg_funded": 300.86206896551727}, "Health": {"total_funds": 4100.0, "num_loans": 4.0, "avg_funded": 1025.0}, "Retail": {"total_funds": 61375.0, "num_loans": 72.0, "avg_funded": 852.4305555555555}, "Manufacturing": {"total_funds": 1175.0, "num_loans": 3.0, "avg_funded": 391.6666666666667}, "Transportation": {"total_funds": 3875.0, "num_loans": 8.0, "avg_funded": 484.375}, "Food": {"total_funds": 93125.0, "num_loans": 91.0, "avg_funded": 1023.3516483516484}, "Agriculture": {"total_funds": 62750.0, "num_loans": 130.0, "avg_funded": 482.6923076923077}, "Personal Use": {"total_funds": 8425.0, "num_loans": 18.0, "avg_funded": 468.05555555555554}, "Construction": {"total_funds": 0.0, "num_loans": 0.0, "avg_funded": 0.0}, "Services": {"total_funds": 18050.0, "num_loans": 25.0, "avg_funded": 722.0}, "Education": {"total_funds": 78600.0, "num_loans": 89.0, "avg_funded": 883.1460674157304}, "Clothing": {"total_funds": 35925.0, "num_loans": 20.0, "avg_funded": 1796.25}}, "countries": {"Turkey": {"total_funds": 2075, "num_loans": 4, "avg_funded": 518}, "Madagascar": {"total_funds": 4250, "num_loans": 16, "avg_funded": 265}, "India": {"total_funds": 4875, "num_loans": 24, "avg_funded": 203}, "Nepal": {"total_funds": 3725, "num_loans": 8, "avg_funded": 465}, "Costa Rica": {"total_funds": 475, "num_loans": 1, "avg_funded": 475}, "Cambodia": {"total_funds": 6950, "num_loans": 18, "avg_funded": 386}, "Rwanda": {"total_funds": 1600, "num_loans": 1, "avg_funded": 1600}, "Peru": {"total_funds": 37550, "num_loans": 28, "avg_funded": 1341}, "Palestine": {"total_funds": 9800, "num_loans": 5, "avg_funded": 1960}, "Nigeria": {"total_funds": 1050, "num_loans": 7, "avg_funded": 150}, "Cameroon": {"total_funds": 700, "num_loans": 2, "avg_funded": 350}, "Burkina Faso": {"total_funds": 1150, "num_loans": 2, "avg_funded": 575}, "Ecuador": {"total_funds": 28750, "num_loans": 22, "avg_funded": 1306}, "Ghana": {"total_funds": 8175, "num_loans": 5, "avg_funded": 1635}, "Myanmar (Burma)": {"total_funds": 6150, "num_loans": 4, "avg_funded": 1537}, "El Salvador": {"total_funds": 4625, "num_loans": 16, "avg_funded": 289}, "Malawi": {"total_funds": 1275, "num_loans": 1, "avg_funded": 1275}, "Togo": {"total_funds": 2025, "num_loans": 11, "avg_funded": 184}, "Guatemala": {"total_funds": 950, "num_loans": 2, "avg_funded": 475}, "Zimbabwe": {"total_funds": 5400, "num_loans": 5, "avg_funded": 1080}, "Jordan": {"total_funds": 6300, "num_loans": 6, "avg_funded": 1050}, "Armenia": {"total_funds": 6975, "num_loans": 5, "avg_funded": 1395}, "Thailand": {"total_funds": 5700, "num_loans": 2, "avg_funded": 2850}, "Haiti": {"total_funds": 750, "num_loans": 4, "avg_funded": 187}, "Tanzania": {"total_funds": 6775, "num_loans": 10, "avg_funded": 677}, "Colombia": {"total_funds": 2400, "num_loans": 7, "avg_funded": 342}, "Philippines": {"total_funds": 34400, "num_loans": 115, "avg_funded": 299}, "Indonesia": {"total_funds": 10100, "num_loans": 8, "avg_funded": 1262}, "Vietnam": {"total_funds": 12775, "num_loans": 18, "avg_funded": 709}, "Yemen": {"total_funds": 900, "num_loans": 3, "avg_funded": 300}, "Pakistan": {"total_funds": 7800, "num_loans": 13, "avg_funded": 600}, "Albania": {"total_funds": 425, "num_loans": 1, "avg_funded": 425}, "Honduras": {"total_funds": 2200, "num_loans": 4, "avg_funded": 550}, "Mexico": {"total_funds": 1850, "num_loans": 2, "avg_funded": 925}, "Nicaragua": {"total_funds": 8950, "num_loans": 6, "avg_funded": 1491}, "Lebanon": {"total_funds": 9900, "num_loans": 6, "avg_funded": 1650}, "Congo (Dem. Rep.)": {"total_funds": 10375, "num_loans": 2, "avg_funded": 5187}, "Lesotho": {"total_funds": 2175, "num_loans": 2, "avg_funded": 1087}, "Mozambique": {"total_funds": 1125, "num_loans": 6, "avg_funded": 187}, "Uganda": {"total_funds": 4050, "num_loans": 11, "avg_funded": 368}, "Paraguay": {"total_funds": 109050, "num_loans": 44, "avg_funded": 2478}, "Kenya": {"total_funds": 6400, "num_loans": 29, "avg_funded": 220}, "Tajikistan": {"total_funds": 9200, "num_loans": 14, "avg_funded": 657}}};
var submit = document.getElementById("submit");
submit.onclick = function(){
	var amount = document.getElementById("loan_amt").value;
	var sector_box = document.getElementById("sector");
	var sector = sector_box.options[sector_box.selectedIndex].text;
	var themes = $('input:checkbox:checked').map(function() {
    	return this.value;
	}).get();

	console.log("Amount:" + amount);
	console.log("Sector:" + sector);
	console.log("Theme:" + themes);
	var theme_avg = 0.0;
	var theme_total = 0.0;
	for (i = 0; i < themes.length; i++) { 
    	theme_total += map["themes"][themes[i]]["avg_funded"];
    	console.log("Theme Amount of " + themes[i] + ": " + map["themes"][themes[i]]["avg_funded"]);
	}
	if (themes.length == 0) {
		theme_avg = 0;
	} else {
		theme_avg = Math.trunc(theme_total / themes.length);
	}
	console.log("Total theme amount:" + theme_total);
	console.log("Total theme avg:" + theme_avg);

	var sector_avg = Math.trunc(map["sectors"][sector]["avg_funded"]);
	console.log("Sector avg:" + sector_avg);

	var total_avg = Math.trunc((sector_avg + theme_avg) / (themes.length + 1));
	console.log("Final avg:" + total_avg);
	
	var total_dev = .477 * total_avg;
	var upper_total =  total_avg + total_dev;
	var lower_total = total_avg - total_dev;
	if (amount > upper_total){
		document.getElementById("MainBlock").textContent="Campaign Amount may be too High";
		document.getElementById("HelpBlock").textContent="Your campaign Amount is higher than the Average of the Sector and Themes you've chosen. Perhaps consider lowering the campaign amount to be closer to similar campaigns that have been funded";
	} else if (amount < lower_total) {
		document.getElementById("MainBlock").textContent="Campaign Amount may be too Low";
		document.getElementById("HelpBlock").textContent="Your campaign Amount is lower than the Average of the Sector and Themes you've chosen. Perhaps consider increasing the campaign amount to be closer to similar campaigns that have been funded";
	} else {
		document.getElementById("MainBlock").textContent="Campaign Amount on target!";
		document.getElementById("HelpBlock").textContent="Your campaign amount is similar to others that have been funded in the Sector and theme you've chosen!";
	}
	document.getElementById("Sector").textContent="within the Sector of " + sector;
	document.getElementById("ThemeList").textContent=", and themes: " + themes + ".";
	document.getElementById("InputAmt").textContent=(amount);
	document.getElementById("ThemeAvg").textContent=(theme_avg);
	document.getElementById("SectorAvg").textContent=(sector_avg);
	document.getElementById("TotalAvg").textContent=(total_avg);
	
	}
});

